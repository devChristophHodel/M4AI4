
---
title:    "Ejercicio práctico Clustering"
license:  by-nc-sa
urlcolor: blue
output:
  word_document:  default
  html_document: 
    theme:        cosmo 
    highlight:    tango 
    toc:          true
    toc_float:    true
    code_folding: show
  epuRate::epurate:
    toc:             TRUE
    number_sections: FALSE
    code_folding:    "show"
  pdf_document:   default
---

<style>
body {
text-align: justify}
</style>

# 1. Planteamiento del problema

En este ejercicio te pediré que imagines que estás trabajando como científico de de datos en una empresa de vinos blancos portugueses, la cuál dispone de un amplio catálogo de vinos.

Para este ejercicio nos enfocaremos en un set de datos que representa la calidad de distintos tipos de vino blanco. Dicha calidad comprende valores entre 3 y 9.

A tal efecto, disponemos de 11 variables explicativas. Encontrarás más información del dataset en el fichero 4.3_AD_ejercicio_diccionario.names

Para este ejercicio, nos interesa hacer un análisis de los distintos clusters que podemos crear fijándonos únicamente en las variables explicativas, con el objetivo de crear distintos perfiles de vino en función de las características químicas que tiene cada uno de ellos.

```{r,warning=FALSE,message=FALSE}
# Carga paquetes necesarios
library(ggplot2)
library(factoextra)
```

Carga el dataset

```{r,warning=FALSE,message=FALSE}
# Cargar del datase
vinos_df_orig <- read.csv("C:/Users/hodel/Documents/GitHub/M4AI4/winequality-white.csv",
                     sep = ";", header=TRUE)

head(vinos_df_orig)

summary(vinos_df_orig)

```

Crea un nuevo dataset que contenga únicamente las variables explicativas normalizadas utilizando la función scale para poder garantizar que todas las variables tengan igual peso en el algoritmo k-means.

```{r,warning=FALSE,message=FALSE}
# Normalizar variables explicativas
vinos_df_scaled <- scale(vinos_df_orig[,names(vinos_df_orig) != 'quality'])

summary(vinos_df_scaled)
```

# 1.1. Selección del número óptimo de clusters

* **Ejercicio 1**: Indica cuál es el número óptimo o el intervalo óptimo de clusters según el elbow method. Fija como semilla el valor 123. Justifica tu respuesta. 

```{r,warning=FALSE,message=FALSE}

set.seed(123)

# Visualización del elbow method
fviz_nbclust(
            x = vinos_df_scaled, 
            FUNcluster = kmeans, 
            method = "wss", 
            k.max = 15, 
            diss = get_dist(vinos_df_scaled, method = "euclidean"), nstart = 50
            )


```
```{r}
print("En la visualización del elbow method encima, a partir de seis clusters, la reducción en la suma total de cuadrados internos parece
estabilizarse, indicando que K = 6. Parece una buena elección.")
```


* **Ejercicio 2**: Indica cuál es el número óptimo o el intervalo óptimo de clusters según el dendrograma. Justifica tu respuesta. 


```{r}

set.seed(123)

# Se obtiene el dendrograma de Clustering Jerárquico para elegir el número de clusters.
vinos_df_scaled_dendrograma <- hclust(
                                  d = dist(
                                          x = vinos_df_scaled, 
                                          method = "euclidean"
                                          ),
                                          method = "complete")

fviz_dend(
          x = vinos_df_scaled_dendrograma, 
          cex = 0.5, 
          main = "Linkage completo",
          sub = "Distancia euclídea"
          ) +  theme(plot.title =  element_text(hjust = 0.5, size = 15))

```
```{r}
print("El numero optimo de clusters segun el dendrograma parece ser 6. Al cortar el dendrogrma a ese altura, las uniones entre los grupos todavia occuren a una altura relativamente eleveada, lo que indica que la distancia intercluster es significativa. Ademas elegir 6 clusters es coherente con lo observado en el metodo del code (ejercicio 1).")
```
 
# 1.3. Sugerencias de departamentos internos de la empresa

* **Ejercicio 3**: Desde el departamento de marketing nos solicitan realizar un análisis lo más simple posible para poder categorizar los vinos en dos grupos distintos. Es decir, nos piden que hagamos únicamente dos clusters y los analicemos. ¿En vistas de los resultados obtenidos por el elbow method y el dendrograma consideras que podrías tener sentido? Justifica tu respuesta

```{r}
print("Con el conjunto de datos actual, no tiene mucho sentido agrupar en dos clusters.")
print("Segun el grafico del metodo del codo, con dos clusters la suma total de cuadrados internos siege siendo muy elevada, lo que indica, que la compactacion de los grupos es baja.")
print("Al cortar el dendrograma para formar dos clusters, significa que los clusters van a ser muy desbalanceados. El primer cluster va a incluir solo muy pocos observaciones, mientras el cluster dos va a incluier casi todos las observaciones. La capacidad de separacion seria muy baja.")
```

* **Ejercicio 4**: Desde el departamento de producto nos solicitan realizar un análisis más complejo con el objetivo de agrupar los vinos con más matices. Según el equipo de sommeliers de la empresa, estos consideran que hay 6 tipos de vino en función del aroma y el gusto que desprende cada uno de ellos. ¿Según la interpretación que se desprende del dendrograma, consideras que podrías tener sentido agrupar los distintos vinos en 6 clusters distintos? Justifica tu respuesta

```{r}
print("Si, agrupar en 6 clusters tiene sentido.")
print("Segun el grafico del metodo del codo, a partir de k = 6, la reducción en la suma total de cuadrados internos comienza estabilizarse, indicando que seis clusters, parecen una buena eleccion.")
print("Al cortar el dendrogrma al altura para formar 6 grupos, las uniones entre los grupos todavia occuren a una altura relativamente eleveada, significa que los grupos sieguen estando bien separados.")
```

# 1.4. Análisis de resultados

Crea un modelo k-means con 2 centroides con un valor de semilla igual a 123. Imprime el valor de los centroides en cada variable.

```{r}

set.seed(123)

# Crear modelo k-means con 2 centroides
km_clusters_vino_e_4 <- kmeans(
                          x = vinos_df_scaled, 
                          centers = 2, # 2 centroides
                          nstart = 50
                          )


# Imprimir valor de los centroides en cada variable 
print(km_clusters_vino_e_4$centers)

# fviz_cluster(
#             object = km_clusters_vino, 
#             data = vinos_df_scaled, 
#             show.clust.cent = TRUE,
#             ellipse.type = "euclid", 
#             star.plot = TRUE,
#             repel = TRUE
#             ) +
#             labs(title = "Resultados clustering K-means") +
#             theme_bw() +
#             theme(legend.position = "none")

```

* **Ejercicio 5**: En vistas del resultado anterior, ¿Qué variables parecen ser más importantes en la diferenciación de cada cluster? Si tuvieses que darle un nombre comercial a cada uno de los clusters que nombre le darías? Justifica tu respuesta

```{r}
print("Cluster 1: Las variables density, residual.sugar y total.sulfur.dioxide suelen que influir el compartamiente del cluster 1 lo mas de manera positivo. En cambio, las variables alcohol y ph presentan valores inferiores al promedio. Vinos dulces con un cuerpo pronunciado, que pueden tener aditivos de sulfur dioxide.")
print("Cluster 2: Las variables alcohol y pH suelen que influir el compartamiente del cluster 2 lo mas de manera positivo. En cambio, las variables density y residual.sugar presentan valores inferiores al promedio. Vinos  ligeros, con contenido de alcohol moderada.")


cat(strrep("-", 200), "\n")
print("Nombres comerciales:")
print("Cluster 1: Vinos dulces y estructurados")
print("por su tasa de residual.sugar y su densidad alto")
cat(strrep("- -", 15), "\n")
print("Cluster 2: Vinos secos y naturales ")
print("por su tasa de azucar y total.sulfur.dioxide baja.")
```

* **Ejercicio 6**: ¿Cuál de los dos clusters creados consideras que tiene, en promedio, un valor más alto en la variable quality? Justifica tu respuesta

```{r}
# Anadir variable cluster al vinos_df_orig 
vinos_df_scaled$cluster = km_clusters_vino_e_4$cluster

# aggregar por cluster (1 y 2) y calculando el promedio per cluster
aggregate(vinos_df_orig$quality, by = list(Cluster = vinos_df_scaled$cluster), FUN = mean)


```

```{r}

print("Segun la agrupacion de los clusters presentada anteriormente, se concluye que cluster 2 agrupa vinos que tienen en promedio mayor calid (6.060524) que los vinos del Cluster 1 (5.603475).")

```

Crea un modelo k-means con 6 centroides con un valor de semilla igual a 123 y iter.max=30. Imprime el valor de los centroides en cada variable.



```{r}

set.seed(123)

# Crear modelo k-means con 6 centroides
km_clusters_vino_6 <- kmeans(
                          x = vinos_df_scaled, 
                          centers = 6, # 6 centroides
                          nstart = 50,
                          iter.max = 30      # máximo de iteraciones
                          )


# Imprimir valor de los centroides en cada variable 
print(km_clusters_vino_6$centers)
```

* **Ejercicio 7**: En vistas del resultado anterior, ¿Qué variables parecen ser más importantes en la diferenciación de cada cluster? Si tuvieses que darle un nombre comercial a cada uno de los clusters que nombre le darías? Justifica tu respuesta

```{r}

print("Cluster 1: Alta concentracion de volatile.acidity y baja cantidad de citric.acid")
print("Cluster 2: Alta concentracion de chlorides y baja valor ph")
print("Cluster 3: Alta concentracion de alcohol y baja tasa de densidad")
print("Cluster 4: Alta concentracion de densidad y total.sulfur.dioxide y baja tasa de alcohol")
print("Cluster 5: Alta concentracion de fixed.acidity y baja tasa de valor ph. Concentracion moderad de alcohol.")
print("Cluster 6: Alta concentracion de valor pH y sulphates y baja tasa de volatile.acidity")


cat(strrep("-", 200), "\n")

print("Nombres comerciales:")
print("Cluster 1: Buen vino para cocinar.")
print("Por su volatile.acidity alta")
cat("\n")

print("Cluster 2: Vino fresco y salino")
print("Por su tasa de chlorides alta y ph baja valor ph (mas acido)")
cat("\n")

print("Cluster 3: Vino seco y alcohólico")
print("Por su tasa de alcohol alta y baja tasa de densidad.")
cat("\n")

print("Cluster 4: Vino dulce ligero.")
print("Por su alta concentracion de densidad y baja tasa de alcohol.")
cat("\n")

print("Cluster 5: Vino seco y fresco")
print("Por su alta concentracion de fixed.acidity y baja tasa de valor ph.")
cat("\n")

print("Cluster 6: Vino suave de alta cualiad")
print("Por su alto valor ph y su baja tasa de volatile.acidity")
```

* **Ejercicio 8**: Indica cuál es el cluster con un valor más alto en la variable quality y con un valor más bajo. Justifica tu respuesta

```{r}
# Anadir variable cluster al vinos_df_orig 
vinos_df_scaled$cluster6 = km_clusters_vino_6$cluster

# aggregar por cluster y calculando el promedio per cluster
aggregate(vinos_df_orig$quality, by = list(Cluster = vinos_df_scaled$cluster6), FUN = mean)

```

```{r}

print("Conclusion segun la agrupacion de los clusters presentada anteriormente.")

print("Cluster 3 es el cluster con el valor promedio mas alto (6.468884) en la variable quality")
print("Cluster 1 es es cluster con el valor promedio mas bajo (5.286000) en la variable quality")


```
## 2. Puntuación del del ejercicio

Este ejercicio se puntuará con 10 puntos, siendo el mínimo necesario para superar la prueba de 5 puntos. 
La puntuación es la siguiente:

* Ejercicio 1: 1 punto

* Ejercicio 2: 1 punto

* Ejercicio 3: 1 punto

* Ejercicio 4: 1 punto

* Ejercicio 5: 1.5 puntos

* Ejercicio 6: 1.5 puntos

* Ejercicio 7: 1.5 puntos

* Ejercicio 8: 1.5 puntos
